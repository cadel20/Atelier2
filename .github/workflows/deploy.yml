name: Deploy to GitHub Pages

on:
  push:
    branches: [main]
  workflow_dispatch:

permissions:
  pages: write
  id-token: write

jobs:
  deploy:
    runs-on: ubuntu-latest
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    
    steps:
    - name: Checkout
      uses: actions/checkout@v4
    
    - name: Fix CSS paths in HTML
      run: |
        echo "ğŸ”§ VÃ©rification des liens CSS..."
        
        if [ -f "public/index.html" ]; then
          # S'assurer que les liens CSS sont corrects
          echo "ğŸ“„ Correction de index.html..."
          
          # Remplacer les chemins absolus par relatifs
          sed -i 's|href="/css/|href="css/|g' public/index.html
          
          # S'assurer que les deux CSS sont liÃ©s
          if ! grep -q "responsive.css" public/index.html; then
            echo "â• Ajout de responsive.css..."
            sed -i '/style.css/ a\    <link rel="stylesheet" href="css/responsive.css">' public/index.html
          fi
          
          echo "âœ… Liens CSS configurÃ©s:"
          grep -i "href.*css" public/index.html
        else
          echo "âŒ public/index.html manquant"
          exit 1
        fi
        
        echo ""
        echo "ğŸ“ Structure CSS:"
        if [ -d "public/css" ]; then
          find public/css -name "*.css" | sed 's/^/  ğŸ“„ /'
        else
          echo "  âŒ Dossier css/ manquant"
          mkdir -p public/css
          touch public/css/style.css public/css/responsive.css
          echo "  âœ… Dossier css/ crÃ©Ã© avec fichiers vides"
        fi
    
    - name: Setup Pages
      uses: actions/configure-pages@v4
    
    - name: Upload artifact
      uses: actions/upload-pages-artifact@v3
      with:
        path: "public"
    
    - name: Deploy to GitHub Pages
      id: deployment
      uses: actions/deploy-pages@v4
    
    - name: Verify CSS deployment
      run: |
        echo "âœ… SITE DÃ‰PLOYÃ‰ !"
        echo ""
        echo "ğŸ¨ VOTRE CSS EST MAINTENANT DISPONIBLE:"
        echo ""
        echo "1. style.css â†’ ${{ steps.deployment.outputs.page_url }}css/style.css"
        echo "2. responsive.css â†’ ${{ steps.deployment.outputs.page_url }}css/responsive.css"
        echo ""
        echo "ğŸ”— AccÃ¨s direct au site:"
        echo "${{ steps.deployment.outputs.page_url }}"